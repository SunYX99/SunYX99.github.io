<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringAoc | Harrson's blog</title><meta name="description" content="SpringAoc"><meta name="keywords" content="Spring"><meta name="author" content="Harrson"><meta name="copyright" content="Harrson"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SpringAoc"><meta name="twitter:description" content="SpringAoc"><meta name="twitter:image" content="http://example.com/img/post.jpg"><meta property="og:type" content="article"><meta property="og:title" content="SpringAoc"><meta property="og:url" content="http://example.com/2020/04/05/SpringAoc/"><meta property="og:site_name" content="Harrson's blog"><meta property="og:description" content="SpringAoc"><meta property="og:image" content="http://example.com/img/post.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://example.com/2020/04/05/SpringAoc/"><link rel="prev" title="Spring事务控制" href="http://example.com/2020/04/05/Spring%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6/"><link rel="next" title="SpringIoc（基于注解配置）" href="http://example.com/2020/04/04/SpringIoc%EF%BC%88%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%EF%BC%89/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.itsyx.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP-的相关概念"><span class="toc-number">1.</span> <span class="toc-text">AOP 的相关概念  </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP-概述"><span class="toc-number">1.1.</span> <span class="toc-text">AOP 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是-AOP"><span class="toc-number">1.1.1.</span> <span class="toc-text">什么是 AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-的作用及优势"><span class="toc-number">1.1.2.</span> <span class="toc-text">AOP 的作用及优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-的实现方式"><span class="toc-number">1.1.3.</span> <span class="toc-text">AOP 的实现方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态代理回顾"><span class="toc-number">1.2.</span> <span class="toc-text">动态代理回顾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#动态代理的特点"><span class="toc-number">1.2.1.</span> <span class="toc-text">动态代理的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态代理常用的有两种方式"><span class="toc-number">1.2.2.</span> <span class="toc-text">动态代理常用的有两种方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-JDK-官方的-Proxy-类创建代理对象"><span class="toc-number">1.2.3.</span> <span class="toc-text">使用 JDK 官方的 Proxy 类创建代理对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-CGLib-的-Enhancer-类创建代理对象"><span class="toc-number">1.2.4.</span> <span class="toc-text">使用 CGLib 的 Enhancer 类创建代理对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-中的-AOP"><span class="toc-number">2.</span> <span class="toc-text">Spring 中的 AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-中-AOP-的细节"><span class="toc-number">2.1.</span> <span class="toc-text">Spring 中 AOP 的细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-相关术语"><span class="toc-number">2.1.1.</span> <span class="toc-text">AOP 相关术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-中的-AOP-要明确的事"><span class="toc-number">2.1.2.</span> <span class="toc-text">spring 中的 AOP 要明确的事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于代理的选择"><span class="toc-number">2.1.3.</span> <span class="toc-text">关于代理的选择</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基于-XML-的-AOP-配置"><span class="toc-number">3.</span> <span class="toc-text">基于 XML 的 AOP 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境搭建"><span class="toc-number">3.1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：导入依赖"><span class="toc-number">3.1.1.</span> <span class="toc-text">第一步：导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：创建-spring-的配置文件并导入约束"><span class="toc-number">3.1.2.</span> <span class="toc-text">第二步：创建 spring 的配置文件并导入约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：-配置-spring-的-ioc"><span class="toc-number">3.1.3.</span> <span class="toc-text">第三步： 配置 spring 的 ioc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步：-抽取公共代码制作成通知"><span class="toc-number">3.1.4.</span> <span class="toc-text">第四步： 抽取公共代码制作成通知</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置步骤"><span class="toc-number">3.2.</span> <span class="toc-text">配置步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：把通知类用-bean-标签配置起来"><span class="toc-number">3.2.1.</span> <span class="toc-text">第一步：把通知类用 bean 标签配置起来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#切入点表达式说明"><span class="toc-number">3.2.2.</span> <span class="toc-text">切入点表达式说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环绕通知"><span class="toc-number">3.2.3.</span> <span class="toc-text">环绕通知</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基于注解的-AOP-配置"><span class="toc-number">4.</span> <span class="toc-text">基于注解的 AOP 配置 </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#环境搭建-1"><span class="toc-number">4.1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：-准备必要的代码和-jar-包"><span class="toc-number">4.1.1.</span> <span class="toc-text">第一步： 准备必要的代码和 jar 包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：-在配置文件中导入-context-的名称空间"><span class="toc-number">4.1.2.</span> <span class="toc-text">第二步： 在配置文件中导入 context 的名称空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：把资源使用注解配置"><span class="toc-number">4.1.3.</span> <span class="toc-text">第三步：把资源使用注解配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置步骤-1"><span class="toc-number">4.2.</span> <span class="toc-text">配置步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：把通知类也使用注解配置"><span class="toc-number">4.2.1.</span> <span class="toc-text">第一步：把通知类也使用注解配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：在通知类上使用-Aspect-注解声明为切面"><span class="toc-number">4.2.2.</span> <span class="toc-text">第二步：在通知类上使用@Aspect 注解声明为切面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：在增强的方法上使用注解配置通知"><span class="toc-number">4.2.3.</span> <span class="toc-text">第三步：在增强的方法上使用注解配置通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四步：在-spring-配置文件中开启-spring-对注解-AOP-的支持"><span class="toc-number">4.2.4.</span> <span class="toc-text">第四步：在 spring 配置文件中开启 spring 对注解 AOP 的支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环绕通知注解配置"><span class="toc-number">4.2.5.</span> <span class="toc-text">环绕通知注解配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#切入点表达式注解"><span class="toc-number">4.2.6.</span> <span class="toc-text">切入点表达式注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不使用-XML-的配置方式"><span class="toc-number">4.2.7.</span> <span class="toc-text">不使用 XML 的配置方式</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/post.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Harrson's blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">SpringAoc</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-05 12:18:18"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-05</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-05 15:15:32"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-05</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SSM%E6%A1%86%E6%9E%B6/">SSM框架</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/05/SpringAoc/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/05/SpringAoc/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="AOP-的相关概念"><a href="#AOP-的相关概念" class="headerlink" title="AOP 的相关概念  "></a><center>AOP 的相关概念  </center></h1><h2 id="AOP-概述"><a href="#AOP-概述" class="headerlink" title="AOP 概述"></a>AOP 概述</h2><h3 id="什么是-AOP"><a href="#什么是-AOP" class="headerlink" title="什么是 AOP"></a>什么是 AOP</h3><blockquote>
<p>AOP： 全称是 Aspect Oriented Programming 即： 面向切面编程。 </p>
<p><img src="/" class="lazyload" data-src="/img/Spring/2.png"  alt=""></p>
<p>简单的说它就是把我们程序重复的代码抽取出来，在需要执行的时候，使用动态代理的技术，在不修改源码的基础上，对我们的已有方法进行增强。  </p>
</blockquote>
<h3 id="AOP-的作用及优势"><a href="#AOP-的作用及优势" class="headerlink" title="AOP 的作用及优势"></a>AOP 的作用及优势</h3><blockquote>
<p><strong>作用</strong>：</p>
<ul>
<li>在程序运行期间，不修改源码对已有方法进行增强。</li>
</ul>
<p><strong>优势：</strong></p>
<ul>
<li>减少重复代码</li>
<li>提高开发效率</li>
<li>维护方便  </li>
</ul>
</blockquote>
<h3 id="AOP-的实现方式"><a href="#AOP-的实现方式" class="headerlink" title="AOP 的实现方式"></a>AOP 的实现方式</h3><blockquote>
<p>使用动态代理技术  </p>
</blockquote>
<h2 id="动态代理回顾"><a href="#动态代理回顾" class="headerlink" title="动态代理回顾"></a>动态代理回顾</h2><h3 id="动态代理的特点"><a href="#动态代理的特点" class="headerlink" title="动态代理的特点"></a>动态代理的特点</h3><blockquote>
<p>字节码随用随创建，随用随加载。<br>它与静态代理的区别也在于此。因为静态代理是字节码一上来就创建好，并完成加载。<br>装饰者模式就是静态代理的一种体现。  </p>
</blockquote>
<h3 id="动态代理常用的有两种方式"><a href="#动态代理常用的有两种方式" class="headerlink" title="动态代理常用的有两种方式"></a>动态代理常用的有两种方式</h3><blockquote>
<p>*<em>基于接口的动态代理 *</em></p>
<p>提供者： JDK 官方的 Proxy 类。<br>要求：被代理类最少实现一个接口。<br><strong>基于子类的动态代理</strong><br>提供者：第三方的 CGLib，如果报 asmxxxx 异常，需要导入 asm.jar。<br>要求：被代理类不能用 final 修饰的类（最终类）。   </p>
</blockquote>
<h3 id="使用-JDK-官方的-Proxy-类创建代理对象"><a href="#使用-JDK-官方的-Proxy-类创建代理对象" class="headerlink" title="使用 JDK 官方的 Proxy 类创建代理对象"></a>使用 JDK 官方的 Proxy 类创建代理对象</h3><p>此处我们使用的是一个演员的例子：<br>在很久以前，演员和剧组都是直接见面联系的。没有中间人环节。而随着时间的推移，产生了一个新兴职业：经纪人（中间人），这个时候剧组再想找演员就需要通过经纪人来找了。下面我们就用代码演示出来。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 一个经纪公司的要求:</span><br><span class="line">* 能做基本的表演和危险的表演</span><br><span class="line">*&#x2F;</span><br><span class="line">public interface IActor &#123;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 基本演出</span><br><span class="line">* @param money</span><br><span class="line">*&#x2F;</span><br><span class="line">public void basicAct(float money);</span><br><span class="line">&#x2F;**</span><br><span class="line">* 危险演出</span><br><span class="line">* @param money</span><br><span class="line">*&#x2F;</span><br><span class="line">public void dangerAct(float money);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 一个演员</span><br><span class="line">*&#x2F;</span><br><span class="line">&#x2F;&#x2F;实现了接口，就表示具有接口中的方法实现。即：符合经纪公司的要求</span><br><span class="line">public class Actor implements IActor&#123;</span><br><span class="line">public void basicAct(float money)&#123;</span><br><span class="line">System.out.println(&quot;拿到钱，开始基本的表演： &quot;+money);</span><br><span class="line">&#125;</span><br><span class="line">public void dangerAct(float money)&#123;</span><br><span class="line">System.out.println(&quot;拿到钱，开始危险的表演： &quot;+money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">&#x2F;&#x2F;一个剧组找演员：</span><br><span class="line">final Actor actor &#x3D; new Actor();&#x2F;&#x2F;直接</span><br><span class="line">&#x2F;**</span><br><span class="line">* 代理：</span><br><span class="line">* 间接。</span><br><span class="line">* 获取代理对象：</span><br><span class="line">* 要求：</span><br><span class="line">* 被代理类最少实现一个接口</span><br><span class="line">* 创建的方式</span><br><span class="line">* Proxy.newProxyInstance(三个参数)</span><br><span class="line">* 参数含义：</span><br><span class="line">* ClassLoader：和被代理对象使用相同的类加载器。</span><br><span class="line">* Interfaces：和被代理对象具有相同的行为。实现相同的接口。</span><br><span class="line">* InvocationHandler：如何代理。</span><br><span class="line">* 策略模式：使用场景是：</span><br><span class="line">* 数据有了，目的明确。</span><br><span class="line">* 如何达成目标，就是策略。</span><br><span class="line">*&#x2F;</span><br><span class="line">IActor proxyActor &#x3D; (IActor) Proxy.newProxyInstance(</span><br><span class="line">actor.getClass().getClassLoader(),</span><br><span class="line">actor.getClass().getInterfaces(),</span><br><span class="line">new InvocationHandler() &#123;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 执行被代理对象的任何方法，都会经过该方法。</span><br><span class="line">* 此方法有拦截的功能。</span><br><span class="line">* 参数：</span><br><span class="line">* proxy：代理对象的引用。不一定每次都用得到</span><br><span class="line">* method：当前执行的方法对象</span><br><span class="line">* args：执行方法所需的参数</span><br><span class="line">* 返回值：</span><br><span class="line">* 当前执行方法的返回值</span><br><span class="line">*&#x2F;</span><br><span class="line">@Override</span><br><span class="line">public Object invoke(Object proxy, Method method, Object[] args)</span><br><span class="line">throws Throwable &#123;</span><br><span class="line">String name &#x3D; method.getName();</span><br><span class="line">Float money &#x3D; (Float) args[0];</span><br><span class="line">Object rtValue &#x3D; null;</span><br><span class="line">&#x2F;&#x2F;每个经纪公司对不同演出收费不一样，此处开始判断</span><br><span class="line">if(&quot;basicAct&quot;.equals(name))&#123;</span><br><span class="line">&#x2F;&#x2F;基本演出，没有 2000 不演</span><br><span class="line">if(money &gt; 2000)&#123;</span><br><span class="line">&#x2F;&#x2F;看上去剧组是给了 8000，实际到演员手里只有 4000</span><br><span class="line">&#x2F;&#x2F;这就是我们没有修改原来 basicAct 方法源码，对方法进行了增强</span><br><span class="line">rtValue &#x3D; method.invoke(actor, money&#x2F;2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(&quot;dangerAct&quot;.equals(name))&#123;</span><br><span class="line">&#x2F;&#x2F;危险演出,没有 5000 不演</span><br><span class="line">if(money &gt; 5000)&#123;</span><br><span class="line">&#x2F;&#x2F;看上去剧组是给了 50000，实际到演员手里只有 25000</span><br><span class="line">&#x2F;&#x2F;这就是我们没有修改原来 dangerAct 方法源码，对方法进行了增强</span><br><span class="line">rtValue &#x3D; method.invoke(actor, money&#x2F;2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return rtValue;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F;没有经纪公司的时候，直接找演员。</span><br><span class="line">&#x2F;&#x2F; actor.basicAct(1000f);</span><br><span class="line">&#x2F;&#x2F; actor.dangerAct(5000f);</span><br><span class="line">&#x2F;&#x2F;剧组无法直接联系演员，而是由经纪公司找的演员</span><br><span class="line">proxyActor.basicAct(8000f);</span><br><span class="line">proxyActor.dangerAct(50000f);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-CGLib-的-Enhancer-类创建代理对象"><a href="#使用-CGLib-的-Enhancer-类创建代理对象" class="headerlink" title="使用 CGLib 的 Enhancer 类创建代理对象"></a>使用 CGLib 的 Enhancer 类创建代理对象</h3><p>还是那个演员的例子，只不过不让他实现接口。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 一个演员</span><br><span class="line">*&#x2F;</span><br><span class="line">public class Actor&#123;&#x2F;&#x2F;没有实现任何接口</span><br><span class="line">public void basicAct(float money)&#123;</span><br><span class="line">System.out.println(&quot;拿到钱，开始基本的表演： &quot;+money);</span><br><span class="line">&#125;</span><br><span class="line">public void dangerAct(float money)&#123;</span><br><span class="line">System.out.println(&quot;拿到钱，开始危险的表演： &quot;+money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Client &#123;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 基于子类的动态代理</span><br><span class="line">* 要求：</span><br><span class="line">* 被代理对象不能是最终类</span><br><span class="line">* 用到的类：</span><br><span class="line">* Enhancer</span><br><span class="line">* 用到的方法：</span><br><span class="line">* create(Class, Callback)</span><br><span class="line">* 方法的参数：</span><br><span class="line">* Class：被代理对象的字节码</span><br><span class="line">* Callback：如何代理</span><br><span class="line">* @param args</span><br><span class="line">*&#x2F;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">final Actor actor &#x3D; new Actor();</span><br><span class="line">Actor cglibActor &#x3D; (Actor) Enhancer.create(actor.getClass(),</span><br><span class="line">new MethodInterceptor() &#123;</span><br><span class="line">&#x2F;**</span><br><span class="line">* 执行被代理对象的任何方法，都会经过该方法。在此方法内部就可以对被代理对象的任何</span><br><span class="line">方法进行增强。</span><br><span class="line">*</span><br><span class="line">* 参数：</span><br><span class="line">* 前三个和基于接口的动态代理是一样的。</span><br><span class="line">* MethodProxy：当前执行方法的代理对象。</span><br><span class="line">* 返回值：</span><br><span class="line">* 当前执行方法的返回值</span><br><span class="line">*&#x2F;</span><br><span class="line">@Override</span><br><span class="line">public Object intercept(Object proxy, Method method, Object[] args,</span><br><span class="line">MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line">String name &#x3D; method.getName();</span><br><span class="line">Float money &#x3D; (Float) args[0];</span><br><span class="line">Object rtValue &#x3D; null;</span><br><span class="line">if(&quot;basicAct&quot;.equals(name))&#123;</span><br><span class="line">&#x2F;&#x2F;基本演出</span><br><span class="line">if(money &gt; 2000)&#123;</span><br><span class="line">rtValue &#x3D; method.invoke(actor, money&#x2F;2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(&quot;dangerAct&quot;.equals(name))&#123;</span><br><span class="line">&#x2F;&#x2F;危险演出</span><br><span class="line">if(money &gt; 5000)&#123;</span><br><span class="line">rtValue &#x3D; method.invoke(actor, money&#x2F;2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return rtValue;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">cglibActor.basicAct(10000);</span><br><span class="line">cglibActor.dangerAct(100000);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-中的-AOP"><a href="#Spring-中的-AOP" class="headerlink" title="Spring 中的 AOP"></a><center>Spring 中的 AOP</center></h1><h2 id="Spring-中-AOP-的细节"><a href="#Spring-中-AOP-的细节" class="headerlink" title="Spring 中 AOP 的细节"></a>Spring 中 AOP 的细节</h2><h3 id="AOP-相关术语"><a href="#AOP-相关术语" class="headerlink" title="AOP 相关术语"></a>AOP 相关术语</h3><blockquote>
<p><strong>Joinpoint(连接点):</strong><br>所谓连接点是指那些被拦截到的点。在 spring 中,这些点指的是方法,因为 spring 只支持方法类型的<br>连接点。<br><strong>Pointcut(切入点):</strong><br>所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义。  </p>
<p><strong>Advice(通知/增强):</strong><br>所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。<br>通知的类型： 前置通知,后置通知,异常通知,最终通知,环绕通知。<br><strong>Introduction(引介):</strong><br>引介是一种特殊的通知在不修改类代码的前提下, Introduction 可以在运行期为类动态地添加一些方<br>法或 Field。<br><strong>Target(目标对象):</strong><br>代理的目标对象。<br><strong>Weaving(织入):</strong><br>是指把增强应用到目标对象来创建新的代理对象的过程。<br>spring 采用动态代理织入，而 AspectJ 采用编译期织入和类装载期织入。<br><strong>Proxy（代理） :</strong><br>一个类被 AOP 织入增强后，就产生一个结果代理类。<br><strong>Aspect(切面):</strong><br>是切入点和通知（引介）的结合。  </p>
</blockquote>
<h3 id="spring-中的-AOP-要明确的事"><a href="#spring-中的-AOP-要明确的事" class="headerlink" title="spring 中的 AOP 要明确的事"></a>spring 中的 AOP 要明确的事</h3><blockquote>
<p><strong>a、开发阶段（我们做的）</strong><br>编写核心业务代码（开发主线）：大部分程序员来做，要求熟悉业务需求。<br>把公用代码抽取出来，制作成通知。（开发阶段最后再做）： AOP 编程人员来做。<br>在配置文件中，声明切入点与通知间的关系，即切面。： AOP 编程人员来做。<br><strong>b、运行阶段（ Spring 框架完成的）</strong><br>Spring 框架监控切入点方法的执行。一旦监控到切入点方法被运行，使用代理机制，动态创建目标对<br>象的代理对象，根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行。  </p>
</blockquote>
<h3 id="关于代理的选择"><a href="#关于代理的选择" class="headerlink" title="关于代理的选择"></a>关于代理的选择</h3><blockquote>
<p>在 spring 中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式。  </p>
</blockquote>
<h1 id="基于-XML-的-AOP-配置"><a href="#基于-XML-的-AOP-配置" class="headerlink" title="基于 XML 的 AOP 配置"></a><center>基于 XML 的 AOP 配置</center></h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="第一步：导入依赖"><a href="#第一步：导入依赖" class="headerlink" title="第一步：导入依赖"></a>第一步：导入依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.0.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.0.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.aspectj&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;aspectjweaver&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.8.13&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-dbutils&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-dbutils&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.4&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;c3p0&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;c3p0&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.1.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：创建-spring-的配置文件并导入约束"><a href="#第二步：创建-spring-的配置文件并导入约束" class="headerlink" title="第二步：创建 spring 的配置文件并导入约束"></a>第二步：创建 spring 的配置文件并导入约束</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--此处要导入 aop 的约束--&gt;</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd&quot;&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第三步：-配置-spring-的-ioc"><a href="#第三步：-配置-spring-的-ioc" class="headerlink" title="第三步： 配置 spring 的 ioc"></a>第三步： 配置 spring 的 ioc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置 service --&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;accountService&quot; class&#x3D;&quot;com.syx.service.impl.AccountServiceImpl&quot;&gt;</span><br><span class="line">&lt;property name&#x3D;&quot;accountDao&quot; ref&#x3D;&quot;accountDao&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br><span class="line">  &lt;!--配置Dao对象--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;accountDao&quot; class&#x3D;&quot;com.syx.dao.impl.AccountDaoImpl&quot;&gt;</span><br><span class="line">        &lt;!-- 注入QueryRunner --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;runner&quot; ref&#x3D;&quot;runner&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;!-- 注入ConnectionUtils --&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;connectionUtils&quot; ref&#x3D;&quot;connectionUtils&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">     &lt;!--配置QueryRunner--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;runner&quot; class&#x3D;&quot;org.apache.commons.dbutils.QueryRunner&quot; scope&#x3D;&quot;prototype&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置数据源 --&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;!--连接数据库的必备信息--&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClass&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;jdbcUrl&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;spring&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;user&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 配置Connection的工具类 ConnectionUtils --&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;connectionUtils&quot; class&#x3D;&quot;com.itheima.utils.ConnectionUtils&quot;&gt;</span><br><span class="line">        &lt;!-- 注入数据源--&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;dataSource&quot; ref&#x3D;&quot;dataSource&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第四步：-抽取公共代码制作成通知"><a href="#第四步：-抽取公共代码制作成通知" class="headerlink" title="第四步： 抽取公共代码制作成通知"></a>第四步： 抽取公共代码制作成通知</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public class TransactionManager &#123;</span><br><span class="line">    private ConnectionUtils connectionUtils;</span><br><span class="line"></span><br><span class="line">    public void setConnectionUtils(ConnectionUtils connectionUtils) &#123;</span><br><span class="line">        this.connectionUtils &#x3D; connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 开启事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void beginTransaction() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().setAutoCommit(false);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 提交事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void commit() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().commit();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void rollback() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().rollback();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 释放连接</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void release() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().close();&#x2F;&#x2F;还回连接池中</span><br><span class="line">            connectionUtils.removeConnection();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class ConnectionUtils &#123;</span><br><span class="line"></span><br><span class="line">    private ThreadLocal&lt;Connection&gt; tl &#x3D; new ThreadLocal&lt;Connection&gt;();</span><br><span class="line">    private DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    public void setDataSource(DataSource dataSource) &#123;</span><br><span class="line">        this.dataSource &#x3D; dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取当前线程上的连接</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public Connection getThreadConnection() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            &#x2F;&#x2F;1.先从ThreadLocal上获取</span><br><span class="line">            Connection conn &#x3D; tl.get();</span><br><span class="line">            &#x2F;&#x2F;2.判断当前线程上是否有连接</span><br><span class="line">            if (conn &#x3D;&#x3D; null) &#123;</span><br><span class="line">                &#x2F;&#x2F;3.从数据源中获取一个连接，并且存入ThreadLocal中</span><br><span class="line">                conn &#x3D; dataSource.getConnection();</span><br><span class="line">                tl.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;4.返回当前线程上的连接</span><br><span class="line">            return conn;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 把连接和线程解绑</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void removeConnection()&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h2><h3 id="第一步：把通知类用-bean-标签配置起来"><a href="#第一步：把通知类用-bean-标签配置起来" class="headerlink" title="第一步：把通知类用 bean 标签配置起来"></a>第一步：把通知类用 bean 标签配置起来</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置事务管理器--&gt;</span><br><span class="line">&lt;bean id&#x3D;&quot;txManager&quot; class&#x3D;&quot;com.itheima.utils.TransactionManager&quot;&gt;</span><br><span class="line">    &lt;!-- 注入ConnectionUtils --&gt;</span><br><span class="line">    &lt;property name&#x3D;&quot;connectionUtils&quot; ref&#x3D;&quot;connectionUtils&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">&lt;&#x2F;bean&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：使用 aop:config 声明 aop 配置  </p>
<blockquote>
<p>aop:config:<br><strong>作用</strong>： 用于声明开始 aop 的配置  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;!-- 配置的代码都写在此处 --&gt;</span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br></pre></td></tr></table></figure>

<p>第三步：使用 aop:aspect 配置切面  </p>
<blockquote>
<p>aop:aspect:<br><strong>作用</strong>：<br>用于配置切面。<br><strong>属性</strong>：<br>id： 给切面提供一个唯一标识。<br>ref： 引用配置好的通知类 bean 的 id。  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:aspect id&#x3D;&quot;txAdvice&quot; ref&#x3D;&quot;txManager&quot;&gt;</span><br><span class="line">&lt;!--配置通知的类型要写在此处--&gt;</span><br><span class="line">&lt;&#x2F;aop:aspect&gt;</span><br></pre></td></tr></table></figure>

<p>第四步：使用 aop:pointcut 配置切入点表达式  </p>
<blockquote>
<p>aop:pointcut：<br><strong>作用</strong>：<br>用于配置切入点表达式。就是指定对哪些类的哪些方法进行增强。<br><strong>属性</strong>：<br>expression：用于定义切入点表达式。<br>id： 用于给切入点表达式提供一个唯一标识  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:pointcut expression&#x3D;&quot;execution(</span><br><span class="line">public void com.syx.service.impl.AccountServiceImpl.transfer(</span><br><span class="line">java.lang.String, java.lang.String, java.lang.Float)</span><br><span class="line">)&quot; id&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>第五步：使用 aop:xxx 配置对应的通知类型  </p>
<blockquote>
<p>1.aop:before<br><strong>作用</strong>：<br>用于配置前置通知。 指定增强的方法在切入点方法之前执行<br><strong>属性</strong>：<br>method:用于指定通知类中的增强方法名称<br>ponitcut-ref：用于指定切入点的表达式的引用<br>poinitcut：用于指定切入点表达式<br><strong>执行时间点</strong>：<br>切入点方法执行之前执行  </p>
<p>2.aop:after-returning  </p>
<p><strong>作用</strong>：<br>用于配置后置通知<br><strong>属性</strong>：<br>method： 指定通知中方法的名称。<br>pointct： 定义切入点表达式<br>pointcut-ref： 指定切入点表达式的引用<br><strong>执行时间点</strong>：<br>切入点方法正常执行之后。它和异常通知只能有一个执行  </p>
<p>3.aop:after-throwing<br><strong>作用</strong>：<br>用于配置异常通知<br><strong>属性</strong>：<br>method： 指定通知中方法的名称。<br>pointct： 定义切入点表达式<br>pointcut-ref： 指定切入点表达式的引用<br><strong>执行时间点</strong>：<br>切入点方法执行产生异常后执行。它和后置通知只能执行一个  </p>
<p>4.aop:after<br><strong>作用</strong>：<br>用于配置最终通知<br><strong>属性</strong>：<br>method： 指定通知中方法的名称。<br>pointct： 定义切入点表达式<br>pointcut-ref： 指定切入点表达式的引用<br><strong>执行时间点</strong>：<br>无论切入点方法执行时是否有异常，它都会在其后面执行。  </p>
</blockquote>
<p><strong>xml配置：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:before method&#x3D;&quot;beginTransaction&quot; pointcut-ref&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br><span class="line">&lt;aop:after-returning method&#x3D;&quot;commit&quot; pointcut-ref&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br><span class="line">&lt;aop:after-throwing method&#x3D;&quot;rollback&quot; pointcut-ref&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br><span class="line">&lt;aop:after method&#x3D;&quot;release&quot; pointcut-ref&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="切入点表达式说明"><a href="#切入点表达式说明" class="headerlink" title="切入点表达式说明"></a>切入点表达式说明</h3><blockquote>
<p>execution:匹配方法的执行(常用)<br>execution(表达式)<br>表达式语法： execution([修饰符] 返回值类型 包名.类名.方法名(参数))<br>写法说明：<br>全匹配方式：<br>public void com.syx.service.impl.AccountServiceImpl.saveAccount(com.syx.domain.Account)<br>访问修饰符可以省略<br>void<br>com.syx.service.impl.AccountServiceImpl.saveAccount(com.syx.domain.Account)  </p>
<p>返回值可以使用*号，表示任意返回值</p>
<p>*com.syx.service.impl.AccountServiceImpl.saveAccount(com.syx.domain.Account)<br>包名可以使用<em>号，表示任意包，但是有几级包，需要写几个</em><br>* <em>.</em>.<em>.</em>.AccountServiceImpl.saveAccount(com.syx.domain.Account)<br>使用..来表示当前包，及其子包<br>* com..AccountServiceImpl.saveAccount(com.syx.domain.Account)<br>类名可以使用<em>号，表示任意类<br>\</em> com..<em>.saveAccount(com.syx.domain.Account)<br>方法名可以使用*号，表示任意方法<br>\</em> com..<em>.</em>( com.syx.domain.Account)<br>参数列表可以使用<em>，表示参数可以是任意数据类型，但是必须有参数<br>\</em> com..<em>.</em>(<em>)<br>参数列表可以使用..表示有无参数均可，有参数可以是任意类型<br>\</em> com..<em>.</em>(..)<br>全通配方式：<br>* <em>..</em>.<em>(..)<br>注：<br>通常情况下，我们都是对业务层的方法进行增强，所以切入点表达式都是切到业务层实现类。<br>execution(</em> com.syx.service.impl.<em>.</em>(..))  </p>
</blockquote>
<h3 id="环绕通知"><a href="#环绕通知" class="headerlink" title="环绕通知"></a>环绕通知</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置方式:--&gt;</span><br><span class="line">&lt;aop:config&gt;</span><br><span class="line">&lt;aop:pointcut expression&#x3D;&quot;execution(* com.syx.service.impl.*.*(..))&quot;</span><br><span class="line">id&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br><span class="line">&lt;aop:aspect id&#x3D;&quot;txAdvice&quot; ref&#x3D;&quot;txManager&quot;&gt;</span><br><span class="line">&lt;!-- 配置环绕通知 --&gt;</span><br><span class="line">&lt;aop:around method&#x3D;&quot;transactionAround&quot; pointcut-ref&#x3D;&quot;pt1&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;aop:aspect&gt;</span><br><span class="line">&lt;&#x2F;aop:config&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>aop:around：<br><strong>作用</strong>：<br>用于配置环绕通知<br><strong>属性</strong>：<br>method：指定通知中方法的名称。<br>pointct：定义切入点表达式<br>pointcut-ref：指定切入点表达式的引用<br><strong>说明</strong>：<br>它是 spring 框架为我们提供的一种可以在代码中手动控制增强代码什么时候执行的方式。<br>注意：<br>通常情况下，环绕通知都是独立使用的  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 环绕通知</span><br><span class="line">* @param pjp</span><br><span class="line">* spring 框架为我们提供了一个接口： ProceedingJoinPoint，它可以作为环绕通知的方法参数。</span><br><span class="line">* 在环绕通知执行时， spring 框架会为我们提供该接口的实现类对象，我们直接使用就行。</span><br><span class="line">* @return</span><br><span class="line">*&#x2F;</span><br><span class="line">public Object transactionAround(ProceedingJoinPoint pjp) &#123;</span><br><span class="line">&#x2F;&#x2F;定义返回值</span><br><span class="line">Object rtValue &#x3D; null;</span><br><span class="line">try &#123;</span><br><span class="line">&#x2F;&#x2F;获取方法执行所需的参数</span><br><span class="line">Object[] args &#x3D; pjp.getArgs();</span><br><span class="line">&#x2F;&#x2F;前置通知：开启事务</span><br><span class="line">beginTransaction();</span><br><span class="line">&#x2F;&#x2F;执行方法</span><br><span class="line">rtValue &#x3D; pjp.proceed(args);</span><br><span class="line">&#x2F;&#x2F;后置通知：提交事务</span><br><span class="line">commit();</span><br><span class="line">&#125;catch(Throwable e) &#123;</span><br><span class="line">&#x2F;&#x2F;异常通知：回滚事务</span><br><span class="line">rollback();</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;finally &#123;</span><br><span class="line">&#x2F;&#x2F;最终通知：释放资源</span><br><span class="line">release();</span><br><span class="line">&#125;</span><br><span class="line">return rtValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="基于注解的-AOP-配置"><a href="#基于注解的-AOP-配置" class="headerlink" title="基于注解的 AOP 配置 "></a><center>基于注解的 AOP 配置 </center></h1><h2 id="环境搭建-1"><a href="#环境搭建-1" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="第一步：-准备必要的代码和-jar-包"><a href="#第一步：-准备必要的代码和-jar-包" class="headerlink" title="第一步： 准备必要的代码和 jar 包"></a>第一步： 准备必要的代码和 jar 包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-context&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.0.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.0.8.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.6&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.aspectj&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;aspectjweaver&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.8.13&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-dbutils&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-dbutils&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.4&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;c3p0&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;c3p0&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.9.1.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：-在配置文件中导入-context-的名称空间"><a href="#第二步：-在配置文件中导入-context-的名称空间" class="headerlink" title="第二步： 在配置文件中导入 context 的名称空间"></a>第二步： 在配置文件中导入 context 的名称空间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">xmlns:aop&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&quot;</span><br><span class="line">xmlns:context&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&quot;</span><br><span class="line">xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans.xsd</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;aop&#x2F;spring-aop.xsd</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context</span><br><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context.xsd&quot;&gt;</span><br><span class="line">&lt;!-- 告知 spring 创建容器时要扫描的包 --&gt;</span><br><span class="line">    &lt;context:component-scan base-package&#x3D;&quot;com.syx&quot;&gt;&lt;&#x2F;context:component-scan&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置QueryRunner--&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;runner&quot; class&#x3D;&quot;org.apache.commons.dbutils.QueryRunner&quot; scope&#x3D;&quot;prototype&quot;&gt;&lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;!-- 配置数据源 --&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;dataSource&quot; class&#x3D;&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span><br><span class="line">        &lt;!--连接数据库的必备信息--&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;driverClass&quot; value&#x3D;&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;jdbcUrl&quot; value&#x3D;&quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;spring&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;user&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">        &lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;root&quot;&gt;&lt;&#x2F;property&gt;</span><br><span class="line">    &lt;&#x2F;bean&gt;</span><br><span class="line">    &lt;!-- 开启 spring 对注解 AOP 的支持 --&gt;</span><br><span class="line">    &lt;aop:aspectj-autoproxy&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第三步：把资源使用注解配置"><a href="#第三步：把资源使用注解配置" class="headerlink" title="第三步：把资源使用注解配置"></a>第三步：把资源使用注解配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Repository(&quot;accountDao&quot;)</span><br><span class="line">public class AccountDaoImpl implements IAccountDao &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private QueryRunner runner;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ConnectionUtils connectionUtils;</span><br><span class="line">    </span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">@Service(&quot;accountService&quot;)</span><br><span class="line">public class AccountServiceImpl implements IAccountService&#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private IAccountDao accountDao;</span><br></pre></td></tr></table></figure>

<h2 id="配置步骤-1"><a href="#配置步骤-1" class="headerlink" title="配置步骤"></a>配置步骤</h2><h3 id="第一步：把通知类也使用注解配置"><a href="#第一步：把通知类也使用注解配置" class="headerlink" title="第一步：把通知类也使用注解配置"></a>第一步：把通知类也使用注解配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;txManager&quot;)</span><br><span class="line">public class TransactionManager &#123;</span><br><span class="line">&#x2F;&#x2F;定义一个 DBAssit</span><br><span class="line">    @Autowired</span><br><span class="line">    private ConnectionUtils connectionUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：在通知类上使用-Aspect-注解声明为切面"><a href="#第二步：在通知类上使用-Aspect-注解声明为切面" class="headerlink" title="第二步：在通知类上使用@Aspect 注解声明为切面"></a>第二步：在通知类上使用@Aspect 注解声明为切面</h3><blockquote>
<p>作用：<br>把当前类声明为切面类。  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Component(&quot;txManager&quot;)</span><br><span class="line">@Aspect</span><br><span class="line">public class TransactionManager &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private ConnectionUtils connectionUtils;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="第三步：在增强的方法上使用注解配置通知"><a href="#第三步：在增强的方法上使用注解配置通知" class="headerlink" title="第三步：在增强的方法上使用注解配置通知"></a>第三步：在增强的方法上使用注解配置通知</h3><blockquote>
<p>@Before<br>作用：<br>把当前方法看成是前置通知。<br>属性：<br>value：用于指定切入点表达式，还可以指定切入点表达式的引用。  </p>
<p>@AfterReturning<br>作用：<br>把当前方法看成是后置通知。<br>属性：<br>value：用于指定切入点表达式，还可以指定切入点表达式的引用  </p>
<p>@AfterThrowing<br>作用：<br>把当前方法看成是异常通知。<br>属性：<br>value：用于指定切入点表达式，还可以指定切入点表达式的引用  </p>
<p>@After<br>作用：<br>把当前方法看成是最终通知。<br>属性：<br>value：用于指定切入点表达式，还可以指定切入点表达式的引用  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">     * 开启事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">     @Before(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">    public void beginTransaction() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().setAutoCommit(false);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 提交事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">     @AfterReturning(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">    public void commit() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().commit();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 回滚事务</span><br><span class="line">     *&#x2F;</span><br><span class="line">     @AfterThrowing(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">    public void rollback() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().rollback();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 释放连接</span><br><span class="line">     *&#x2F;</span><br><span class="line">     @After(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">    public void release() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().close();&#x2F;&#x2F;还回连接池中</span><br><span class="line">            connectionUtils.removeConnection();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="第四步：在-spring-配置文件中开启-spring-对注解-AOP-的支持"><a href="#第四步：在-spring-配置文件中开启-spring-对注解-AOP-的支持" class="headerlink" title="第四步：在 spring 配置文件中开启 spring 对注解 AOP 的支持"></a>第四步：在 spring 配置文件中开启 spring 对注解 AOP 的支持</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 开启 spring 对注解 AOP 的支持 --&gt;</span><br><span class="line">&lt;aop:aspectj-autoproxy&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="环绕通知注解配置"><a href="#环绕通知注解配置" class="headerlink" title="环绕通知注解配置"></a>环绕通知注解配置</h3><blockquote>
<p>@Around<br>作用：<br>把当前方法看成是环绕通知。<br>属性：<br>value：用于指定切入点表达式，还可以指定切入点表达式的引用。  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   @Pointcut(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">   private void pt1() &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    * 环绕通知</span><br><span class="line">    *&#x2F;</span><br><span class="line">   @Around(&quot;pt1()&quot;)</span><br><span class="line">   public Object aroundAdvice(ProceedingJoinPoint pjp) &#123;</span><br><span class="line">      Object reValue &#x3D; null;</span><br><span class="line">       try &#123;</span><br><span class="line">           &#x2F;&#x2F;1.获取参数</span><br><span class="line">           Object[] args &#x3D; pjp.getArgs();</span><br><span class="line">           &#x2F;&#x2F;2.开启事务</span><br><span class="line">           this.beginTransaction();</span><br><span class="line">           &#x2F;&#x2F;3.执行方法</span><br><span class="line">           reValue &#x3D; pjp.proceed(args);</span><br><span class="line">           &#x2F;&#x2F;4.提交事务</span><br><span class="line">           this.commit();</span><br><span class="line">           return reValue;</span><br><span class="line">       &#125; catch (Throwable e) &#123;</span><br><span class="line">           &#x2F;&#x2F;5.回滚事务</span><br><span class="line">           this.rollback();</span><br><span class="line">           throw new RuntimeException(e);</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           &#x2F;&#x2F;6.释放资源</span><br><span class="line">           this.release();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="切入点表达式注解"><a href="#切入点表达式注解" class="headerlink" title="切入点表达式注解"></a>切入点表达式注解</h3><blockquote>
<p>@Pointcut<br>作用：<br>指定切入点表达式<br>属性：  value：指定表达式的内容  </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    @Pointcut(&quot;execution(* com.syx.service.impl.*.*(..))&quot;)</span><br><span class="line">    private void pt1() &#123;&#125;;</span><br><span class="line">    &#x2F;&#x2F;引用方式：</span><br><span class="line">&#x2F;**</span><br><span class="line">* 环绕通知</span><br><span class="line">* @param pjp</span><br><span class="line">* @return</span><br><span class="line">*&#x2F;</span><br><span class="line">@Around(&quot;pt1()&quot;)&#x2F;&#x2F;注意：千万别忘了写括号</span><br><span class="line">public Object transactionAround(ProceedingJoinPoint pjp) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不使用-XML-的配置方式"><a href="#不使用-XML-的配置方式" class="headerlink" title="不使用 XML 的配置方式"></a>不使用 XML 的配置方式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@ComponentScan(basePackages&#x3D;&quot;com.itheima&quot;)</span><br><span class="line">@EnableAspectJAutoProxy</span><br><span class="line">public class SpringConfiguration &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Harrson</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2020/04/05/SpringAoc/">http://example.com/2020/04/05/SpringAoc/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Harrson's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/05/Spring%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6/"><img class="prev_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring事务控制</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/04/SpringIoc%EF%BC%88%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%EF%BC%89/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringIoc（基于注解配置）</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/03/SpringIoc（基于xml配置）/" title="SpringIoc（基于xml配置）"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-03</div><div class="relatedPosts_title">SpringIoc（基于xml配置）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/04/SpringIoc（基于注解配置）/" title="SpringIoc（基于注解配置）"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-04</div><div class="relatedPosts_title">SpringIoc（基于注解配置）</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/05/Spring事务控制/" title="Spring事务控制"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-05</div><div class="relatedPosts_title">Spring事务控制</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'GCt8dcylBud6A5N9pPs2wVbN-gzGzoHsz',
  appKey: 'u8mFmUzlqmP7Y5mYAICP60bq',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Harrson</div><div class="footer_custom_text">Hi, welcome to my <a href="https://itsyx.cn/" target="_blank" rel="noopener">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/search/local-search.js"></script></body></html>